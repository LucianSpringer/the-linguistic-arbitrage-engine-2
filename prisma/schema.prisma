// Prisma Schema for Linguistic Arbitrage Engine
// Optimized for SQLite (local dev) with Postgres migration path

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Training Session
model Session {
  id        String   @id @default(cuid())
  userId    String?  // Optional for anonymous sessions
  createdAt DateTime @default(now())
  duration  Int?     // Duration in seconds
  
  scenarioId String?
  
  // Relations
  turns     NegotiationTurn[]
  metrics   Metric[]
  
  @@index([userId])
  @@index([createdAt])
}

// Individual negotiation exchange
model NegotiationTurn {
  id         String   @id @default(cuid())
  sessionId  String
  session    Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  prompt     String   // User input
  response   String   // AI response
  latencyMs  Int      // Response time in milliseconds
  
  cacheHit   Boolean  @default(false)
  timestamp  DateTime @default(now())
  
  @@index([sessionId])
  @@index([timestamp])
}

// Performance metrics per turn
model Metric {
  id        String   @id @default(cuid())
  sessionId String
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  // Core metrics
  verbalVelocity    Float    // Words per minute
  sentimentScore    Float    // -1.0 to 1.0
  confidenceScore   Float    // 0.0 to 1.0
  
  // Extended metrics
  levenshteinDelta  Int?
  hesitationMarkers Int?
  spectralIntensity Float?
  
  timestamp DateTime @default(now())
  
  @@index([sessionId])
  @@index([timestamp])
}
